<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Shop — Cart</title>
<style>
:root {
  --primary:#6e7843;
  --bg:#D9CFAB;
  --card:#fff;
  --muted:#000000;
}
* { box-sizing:border-box; margin:0; padding:0; }
body { font-family: Inter, system-ui, Arial, sans-serif; background: var(--bg); color:#0f172a; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 16px; background:#8f8552; color:#fff; }
header h1 { font-size:20px; }
main { max-width:900px; margin:20px auto; padding:0 12px; }
.cart-item { display:flex; gap:10px; align-items:center; margin-bottom:12px; background:#fff; padding:12px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
.cart-item img { width:80px; height:80px; object-fit:cover; border-radius:8px; }
.cart-item div { flex:1; }
.cart-item .muted { font-size:13px; color:var(--muted); }
.cart-item .qty-controls { display:flex; gap:6px; align-items:center; }
.cart-item .qty-controls button { padding:6px 10px; border:0; border-radius:6px; cursor:pointer; background:var(--primary); color:#fff; }
.cart-footer { display:flex; justify-content:space-between; align-items:center; margin-top:20px; }
.cart-footer .btn { padding:10px 14px; border:0; border-radius:8px; cursor:pointer; background:var(--primary); color:#fff; font-weight:700; }
.cart-footer .btn.ghost { background:#fff; border:1px solid var(--primary); color:var(--primary); }
.empty { text-align:center; padding:40px 12px; color:var(--muted); background:#fff; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.04); }
footer { text-align:center; padding:18px; font-size:14px; color:var(--muted); }
.qty-number { min-width:28px; text-align:center; display:inline-block; }
</style>
</head>
<body>

<header>
  <h1>Your Cart</h1>
  <a href="index.html" style="color:#fff;text-decoration:none;">Back</a>
</header>

<main>
  <div id="cartList"></div>
  <div class="cart-footer">
    <div>Total: <strong id="cartTotal">৳0</strong></div>
    <div>
      <button id="checkoutBtn" class="btn">Checkout</button>
      <button id="clearCart" class="btn ghost">Clear</button>
    </div>
  </div>
</main>

<footer>© <span id="year"></span> Shop</footer>

<script>
/* ====== Storage Keys ====== */
const KEY_PRODUCTS = 'products_v1';
const KEY_CART = 'shop_cart';

/* ====== Helpers ====== */
const el = s=>document.querySelector(s);
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load = (k,fallback)=>{ try { return JSON.parse(localStorage.getItem(k)) || fallback } catch(e) { return fallback; } };

let products = load(KEY_PRODUCTS,[]);
let cart = load(KEY_CART,{});
const cartList = el('#cartList');
const cartTotalEl = el('#cartTotal');
const year = el('#year'); if(year) year.textContent = new Date().getFullYear();

/* ====== Render Cart ====== */
function renderCart(){
  cart = load(KEY_CART,{});
  products = load(KEY_PRODUCTS,[]);
  cartList.innerHTML = '';
  let total = 0;
  const ids = Object.keys(cart);
  if(ids.length === 0){
    cartList.innerHTML = `<div class="empty">Your cart is empty. Add some products from the store.</div>`;
    cartTotalEl.textContent = '৳0';
    return;
  }

  ids.forEach(id => {
    const q = cart[id];
    const p = products.find(x => x.id == id);
    if(!p) return;
    const price = Number(p.price) || 0;
    total += price * q;

    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src="${p.image || 'https://via.placeholder.com/80?text=No+Image'}" alt="${(p.name||'Product')}">
      <div>
        <div style="font-weight:800">${p.name || 'Product'}</div>
        <div class="muted">৳ ${price} × ${q} = ৳ ${ (price*q).toFixed(2) }</div>
      </div>
      <div class="qty-controls">
        <button onclick="changeQty('${id}', ${Math.max(0, q-1)})">-</button>
        <span class="qty-number">${q}</span>
        <button onclick="changeQty('${id}', ${q+1})">+</button>
      </div>
    `;
    cartList.appendChild(div);
  });

  cartTotalEl.textContent = '৳' + total.toFixed(2);
}

/* ====== Change Qty ====== */
window.changeQty = (id, newQty) => {
  cart = load(KEY_CART,{});
  if(newQty <= 0) delete cart[id]; else cart[id] = newQty;
  save(KEY_CART, cart);
  renderCart();
};

/* ====== Buttons ====== */
el('#clearCart')?.addEventListener('click', () => {
  if(confirm('Clear cart?')) {
    save(KEY_CART, {});
    renderCart();
  }
});

/* Checkout: validate cart and go to checkout.html */
el('#checkoutBtn')?.addEventListener('click', () => {
  // re-read cart to ensure we have the latest state
  const currentCart = load(KEY_CART, {});
  if(!currentCart || Object.keys(currentCart).length === 0){
    alert('Cart is empty! Add some products before checkout.');
    return;
  }

  // optional: verify that each product still exists and has stock
  products = load(KEY_PRODUCTS,[]);
  for(const id in currentCart){
    const p = products.find(x => x.id == id);
    if(!p){
      alert('A product in your cart was removed from the store. Please review your cart.');
      return;
    }
    // if you want to enforce stock check here:
    if (p.stock !== undefined && Number(p.stock) < currentCart[id]) {
      alert(`Not enough stock for "${p.name}". Please reduce quantity.`);
      return;
    }
  }

  // proceed to checkout page where user will enter details
  // checkout page will read the cart from localStorage (KEY_CART)
  window.location.href = 'checkout.html';
});

/* Keep page updated if cart/products change in another tab */
window.addEventListener('storage', (e) => {
  if(e.key === KEY_CART || e.key === KEY_PRODUCTS) renderCart();
});

/* ====== Init ====== */
renderCart();
</script>

</body>
</html>